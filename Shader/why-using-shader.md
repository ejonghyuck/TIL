# Why are shaders fast?

## CPU
CPU는 거의 대부분의 작업(연산)을 처리할 수 있는 커다란 공장과 같다.
CPU에게 들어오는 작업은 커다란 작업일 수 있고, 혹은 매우 단순한 작업이기도 하다.
하지만 CPU는 설계상의 구조로 인하여 작업 하나가 끝나야 다음 작업을 진행하게 되는 절차지향적인 성격을 가지고 있다.
요즘 CPU는 4개(혹은 그 이상, 그 이하)의 공장 그룹으로 묶여져서 작업하는데, 그렇다고 순차적인 구조인 것은 마찬가지다.
여기서 그룹 안의 각각의 공장은 `thread`라고 부른다.

![](http://thebookofshaders.com/01/00.jpeg)

## 왜 CPU에서 픽셀을 직접 그리지 않을까?
게임을 비롯한 그래픽 렌더링이 필요한 많은 어플리케이션의 경우 간단한 어플리케이션들에 비해 많은량의 연산을 필요로 한다.
그 이유는 그래픽 요소들 자체가 수많은 픽셀들의 연산으로 이루어지기 때문이다.

스크린위에 각 픽셀들은 각각의 하나의 작은 작업들을 의미한다.
단순히 RGB 컬러의 값만 계산하면 되는 계산 자체는 어쩌면 CPU에겐 단순한 작업일 수 있다.
하지만 문제는 하나의 화면을 렌더링 하기 위해선 스크린 위에 존재하는 모든 픽셀의 개수만큼 작업을 진행해야 한다는 것이다.
만약 800x600 해상도의 게임이라고 하면 한 프레임을 렌더링 하기 위해 480,000개의 픽셀을 계산해야 한다.
그렇다면 게임이 60fps를 유지하기 위해선?
초당 28,800,000번의 계산을 진행해야 한다.

요즘 초고해상도라고 불리는 4k의 경우 3840x2160의 해상도를 의미하는데, 4k 게임의 한 프레임을 렌더링 하기 위해선 8,294,400번의 루프를 돌아야 한다.
CPU에게 모든 픽셀을 그리게 하는 것은 분명 가혹한 행위일 것이다.

![](http://thebookofshaders.com/01/03.jpeg)

## GPU로 해결하자
이 문제를 해결하기 위해 등장한 해결법이 있다. 바로 parellel processing이다.
간단한 명령만 수행할 수 있는 아주 작은 공장들을 무수히 많이 만들은 다음, 이 공장들에게 단순히 픽셀의 색상값만 결정하면 되는 간단한 작업을 한꺼번에 넘기는 것이다.
이런 수천개의 작은 공장들(마이크로 프로세서)이 모여있는 것을 `Graphic Processor Unit, GPU`라고 부른다.

![](http://thebookofshaders.com/01/04.jpeg)

작은 마이크로 프로세서들을 여러개의 파이프들이 묶여있는 판으로 생각하자.
이 판들은 작은 작업밖에 통과시키지 못하지만, 픽셀 계산은 단순히 색만 결정하면 되는 단순한 작업이기 때문에 파이프를 통과하는 것엔 큰 무리가 없을 것이다.
만약 작업들이 많다고 하더라도 파이프가 엄청나게 많기 때문에 몇 번에 나눠서 한번에 처리해도 충분할 것이다.

또한 각각의 마이크로 프로세서에는 마이크로 프로세서 칩 자체에 수학 함수 연산을 직접적으로 할 수 있다.
즉 소프트웨어 레벨이 아닌 하드웨어 레벨에서 수학 연산을 진행하기 때문에 훨씬 더 빠르게 삼각함수, 매트릭스 연산을 수행할 수 있다.

그래서 그래픽 렌더링은 CPU에서 직접 계산하는 것보다 GPU에서 처리되는 쉐이더가 훨씬 빠른 것이다.
